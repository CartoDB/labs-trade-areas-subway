<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Deep-Insights.js</title>
  <meta name=viewport content="width=device-width initial-scale=1">
  <link rel="stylesheet" href="lib/themes/css/deep-insights.css" />
  <link rel="stylesheet" href="lib/rangeslider.css" />
  <link rel="shortcut icon" href="favicon.ico" />
  <script src="lib/deep-insights.uncompressed.js"></script>
  <script src="lib/rangeslider.min.js"></script>
  <script src="//localhost:9096"></script>
  <style type="text/css">
    html, body {
      position:relative;
      height: 100%;
      padding: 0;
      margin: 0;
    }
    .subway_station {
      width: 20px;
      height: 20px;
      background: #f0F;
    }
    /* http://danielstern.ca/range.css/ */
    .Range-wrapper {
      display: inline-block;
      width: 100%;
    }
    .Range {
      -webkit-appearance: none;
      width: 100%;
      margin: 8px 0 16px;
      text-rendering: optimizeLegibility;
      -webkit-text-rendering: optimizeLegibility;
    }
    .Range:focus {
      outline: none;
    }
    .Range::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: #3aa9e3;
      border-radius: 3px;
      border: 0px solid #010101;
    }
    .Range::-webkit-slider-thumb {
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
      border: 1px solid #cbced0;
      height: 20px;
      width: 20px;
      border-radius: 11px;
      background: #ffffff;
      cursor: pointer;
      -webkit-appearance: none;
      margin-top: -8px;
    }
    .Range:focus::-webkit-slider-runnable-track {
      background: #3aa9e3;
    }
    .Range::-moz-range-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: #3aa9e3;
      border-radius: 0px;
      border: 0px solid #010101;
    }
    .Range::-moz-range-thumb {
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
      border: 1px solid #cbced0;
      height: 20px;
      width: 20px;
      border-radius: 11px;
      background: #ffffff;
      cursor: pointer;
    }
    .Range::-ms-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: transparent;
      border-color: transparent;
      color: transparent;
    }
    .Range::-ms-fill-lower {
      background: #3aa9e3;
      border: 0px solid #010101;
      border-radius: 0px;
    }
    .Range::-ms-fill-upper {
      background: #3aa9e3;
      border: 0px solid #010101;
      border-radius: 0px;
    }
    .Range::-ms-thumb {
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
      border: 1px solid #cbced0;
      height: 20px;
      width: 20px;
      border-radius: 11px;
      background: #ffffff;
      cursor: pointer;
      height: 4px;
    }
    .Range:focus::-ms-fill-lower {
      background: #3aa9e3;
    }
    .Range:focus::-ms-fill-upper {
      background: #3aa9e3;
    }
    .Range-period {
      margin-left: 11.25%;
      color: #979EA1;
      font-weight: 400;
      font-size: 10px;
      line-height: 14px;
      font-family: 'Open Sans';
    }
    @media (max-width: 960px) {
      .Range-period {
        margin-left: 7%;
      }
    }
    .Range-period:first-child {
      margin-left: 0;
    }
    .u-ilist > li {
      display: inline-block;
    }
  </style>
</head>
<body>
  <div id="dashboard"></div>
  <div class="CDB-Widget CDB-Widget--light js-iso-selector" style="display: block;">
    <div class="CDB-Widget-body">
      <div class="CDB-Widget-header js-header">
        <div class="CDB-Widget-title CDB-Widget-contentSpaced">
          <h3 class="CDB-Text CDB-Size-large u-ellipsis js-title">Max walking distance</h3>
        </div>
      </div>
      <div class="CDB-Widget-content">
        <div class="CDB-Widget-filter CDB-Widget-contentSpaced">
          <p class="CDB-Text CDB-Size-small is-semibold u-upperCase js-Range-val">2 min</p>
        </div>
        <div class="Range-wrapper">
          <input id="Range" class="Range js-Range" type="range" min="120" max="1200" step="60" value="120" />
          <ul class="u-ilist">
            <li class="Range-period">2 min</li>
            <li class="Range-period">5 min</li>
            <li class="Range-period">10 min</li>
            <li class="Range-period">15 min</li>
            <li class="Range-period">20 min</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <script type="text/template" id="sql_blockgroups">
    SELECT
    nerikcarto.nyc_census_clipped.cartodb_id,
    nerikcarto.nyc_census_clipped.the_geom,
    nerikcarto.nyc_census_clipped.total_pop,
    nerikcarto.nyc_census_clipped.median_age,
    nerikcarto.nyc_census_clipped.per_capita_income,
    nerikcarto.nyc_census_clipped.the_geom_webmercator
    FROM
    nerikcarto.nyc_census_clipped
    WHERE
    ST_Intersects(
    nerikcarto.nyc_census_clipped.the_geom,
      (SELECT
      the_geom
      FROM
      nerikcarto.nyc_subway_stations_l_isos
      WHERE
      data_range = <%= data.range %>
      AND
      station_id = <%= data.station_id %>
      LIMIT 1
      )
    )
    <% Object.keys(data.hists).forEach(function(column) { %>
      AND <%= column %> BETWEEN <%= data.hists[column].min %> AND <%= data.hists[column].max %>
    <%})%>

  </script>
  <script type="text/template" id="sql_dots">
    SELECT
    nerikcarto.nyc_dots_500_2.cartodb_id,
    nerikcarto.nyc_dots_500_2.the_geom,
    nerikcarto.nyc_dots_500_2.pop_per_point,
    nerikcarto.nyc_dots_500_2.the_geom_webmercator,
    c.median_age,
    c.per_capita_income
    FROM nerikcarto.nyc_dots_500_2
    INNER JOIN
      nerikcarto.nyc_census_clipped c
    ON
      nerikcarto.nyc_dots_500_2.geoid = c.geoid
    WHERE
    ST_Within(
    nerikcarto.nyc_dots_500_2.the_geom,
    (SELECT
    the_geom
    FROM
    nerikcarto.nyc_subway_stations_l_isos
    WHERE
    data_range = <%= range %>
    AND
    station_id = <%= station_id %>
    LIMIT 1
    )
    )
  </script>
  <script src="vis.js"></script>
  <script src="index.js"></script>
</body>
</html>
