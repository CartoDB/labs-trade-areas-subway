<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Deep-Insights.js</title>
  <meta name=viewport content="width=device-width initial-scale=1">
  <link rel="stylesheet" href="lib/themes/css/deep-insights.css" />
  <link rel="stylesheet" href="lib/rangeslider.css" />
  <link rel="shortcut icon" href="favicon.ico" />
  <script src="lib/deep-insights.uncompressed.js"></script>
  <script src="lib/rangeslider.min.js"></script>
  <style type="text/css">
    html, body {
      position:relative;
      height: 100%;
      padding: 0;
      margin: 0;
    }
    .subway_station {
      width: 9px !important;
      height: 9px !important;
      background: #fff;
      border-radius: 99px;
      border: 2.5px solid #757575;
    }
    /* http://danielstern.ca/range.css/ */
    .Range-wrapper {
      display: inline-block;
      width: 100%;
    }
    .Range {
      -webkit-appearance: none;
      width: 100%;
      margin: 8px 0 16px;
      text-rendering: optimizeLegibility;
      -webkit-text-rendering: optimizeLegibility;
    }
    .Range:focus {
      outline: none;
    }
    .Range::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: orange;
      background: -webkit-linear-gradient(left, #E4F966 0%,#92D78A 25.1%,#54B6A6 50%,#4B90A7 75%,#5E6888 100%);
      border-radius: 3px;
      border: 0px solid #010101;
    }
    .Range::-webkit-slider-thumb {
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
      border: 1px solid #cbced0;
      height: 20px;
      width: 20px;
      border-radius: 11px;
      background: #ffffff;
      cursor: pointer;
      -webkit-appearance: none;
      margin-top: -8px;
    }
    /* .Range:focus::-webkit-slider-runnable-track {
      background: #3aa9e3;
    } */
    .Range::-moz-range-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: #3aa9e3;
      border-radius: 0px;
      border: 0px solid #010101;
    }
    .Range::-moz-range-thumb {
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
      border: 1px solid #cbced0;
      height: 20px;
      width: 20px;
      border-radius: 11px;
      background: #ffffff;
      cursor: pointer;
    }
    .Range::-ms-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: transparent;
      border-color: transparent;
      color: transparent;
    }
    .Range::-ms-fill-lower {
      background: #3aa9e3;
      border: 0px solid #010101;
      border-radius: 0px;
    }
    .Range::-ms-fill-upper {
      background: #3aa9e3;
      border: 0px solid #010101;
      border-radius: 0px;
    }
    .Range::-ms-thumb {
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
      border: 1px solid #cbced0;
      height: 20px;
      width: 20px;
      border-radius: 11px;
      background: #ffffff;
      cursor: pointer;
      height: 4px;
    }
    .Range:focus::-ms-fill-lower {
      background: #3aa9e3;
    }
    .Range:focus::-ms-fill-upper {
      background: #3aa9e3;
    }
    .Range-period {
      margin-left: 18%;
      color: #979EA1;
      font-weight: 400;
      font-size: 10px;
      line-height: 14px;
      font-family: 'Open Sans';
    }
    @media (max-width: 960px) {
      .Range-period {
        margin-left: 7%;
      }
    }
    .Range-period:first-child {
      margin-left: 0;
    }
    .u-ilist > li {
      display: inline-block;
    }
    div.cartodb-legend-stack {
      top: 32px;
      box-shadow: none;
      border-radius: 0;
      border: 0;
      background: transparent;
      bottom: auto;
      right: auto;
    }
    .CDB-Legend {
      position: absolute;
      border-radius: 4px;
      background: #FFF;
      box-shadow: 0 0 2px 0 rgba(0,0,0,.24),0 4px 8px 0 rgba(0,0,0,.16);
      z-index: 2;
      top: 16px;
      left: 16px;
      padding: 16px 16px 8px 16px;
      width: 200px;
    }
    .CDB-Legend-title {
      font: 600 12px/16px 'Open Sans';
      color: #2E3C43;
    }
    .CDB-Legend-listItem {
      font: 600 10px/14px 'Open Sans';
      color: #2E3C43;
      text-transform: uppercase;
      margin-bottom: 12px;
      position: relative;
    }
    .CDB-Legend-listItem--multiple:before {
      content: "";
      position: absolute;
      width: 5px;
      height: 5px;
      background: #fff;
      border-radius: 50%;
      border: 1px solid #D8D8D8;
      left: -20px;
      top: 4px;
    }
    .CDB-Legend-listItem--multiple:after {
      content: "";
      display: block;
      position: absolute;
      width: 1px;
      background: #D8D8D8;
      left: -17px;
      top: -17px;
      height: 21px;
    }
    .CDB-Legend-listItem--multiple:first-child:after {
      top: -7px;
      height: 12px;
    }
    .CDB-Legend-listItem:last-child {
      margin-bottom: 0;
    }
    .CDB-Legend-listItem:last-child {
      margin-bottom: 0;
    }
    .CDB-Legend-list {
      padding: 8px 0 0 0;
      margin: 8px 0 20px 0;
    }
    .CDB-Legend-list--multiple {
      padding: 8px 0 0 16px;
      margin: 8px 0 20px 8px;
    }
    .CDB-Legend-point {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
      margin-right: 4px;
    }
    .CDB-Legend-pointText {
      display: inline-block;
      vertical-align: middle;
      margin-right: 6px;
    }
    .CDB-Legend-listItemText {
      display: inline-block;
      vertical-align: middle;
    }
    .CDB-ColorRamp-info {
      border-radius: 10px;
      height: 8px;
      position: relative;
    }
    .CDB-ColorRamp-info:after {
      content:"";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      border-radius: 4px;
      border: 1px solid rgba(0, 0, 0, .20);
    }
    .CDB-ColorRamp-text {
      width: auto;
      overflow: hidden;
      margin-bottom: 4px;
    }
    .CDB-ColorRamp-text li:first-child {
      float: left;
    }
    .CDB-ColorRamp-text li:last-child {
      float: right;
    }
    #callToAction {
      position: absolute;
      top: 16px;
      left: 16px;
      height: 34px;
      padding-top: 8px;
      border-radius: 4px;
      background: rgba(0,0,0,.64);
      color: #FFF;
      font-size: 10px;
      font-weight: 600;
      line-height: 14px;
      text-align: center;
      z-index: 1;
      width: 232px;
    }
  </style>
</head>
<body>
  <div id="dashboard"></div>

  <div class="CDB-Widget CDB-Widget--light js-iso-selector" style="display: block;">
    <div class="CDB-Widget-body">
      <div class="CDB-Widget-header js-header">
        <div class="CDB-Widget-title CDB-Widget-contentSpaced">
          <h3 class="CDB-Text CDB-Size-large u-ellipsis js-title">Max walking distance</h3>
        </div>
      </div>
      <div class="CDB-Widget-content">
        <div class="CDB-Widget-filter CDB-Widget-contentSpaced">
          <p class="CDB-Text CDB-Size-small is-semibold u-upperCase js-Range-val">20 min</p>
        </div>
        <div class="Range-wrapper">
          <input id="Range" class="Range js-Range" type="range" min="300" max="1200" step="300" value="1200" />
          <ul class="u-ilist">
            <li class="Range-period">5 min</li>
            <li class="Range-period">10 min</li>
            <li class="Range-period">15 min</li>
            <li class="Range-period">20 min</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script type="text/template" id="html_drop">
    <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-colorsCustom <% if (isSelected) { %>is-selected<% } %>" data-tooltip="Apply colors" data-index="<%= index %>">
       <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i>
    </button>
  </script>

  <script type="text/template" id="sql_blockgroups">
    SELECT
    nerikcarto.nyc_census_clipped.cartodb_id,
    nerikcarto.nyc_census_clipped.the_geom,
    nerikcarto.nyc_census_clipped.total_pop,
    nerikcarto.nyc_census_clipped.median_age,
    nerikcarto.nyc_census_clipped.per_capita_income,
    nerikcarto.nyc_census_clipped.ethnic_1st,
    nerikcarto.nyc_census_clipped.the_geom_webmercator
    FROM
    nerikcarto.nyc_census_clipped
    WHERE
    nerikcarto.nyc_census_clipped.is_in_iso IS true
    AND
    median_age is not null
    and
    per_capita_income is not null
    <% if (data.station_id) { %>
      AND
      ST_Intersects(
      nerikcarto.nyc_census_clipped.the_geom,
        (SELECT
        the_geom
        FROM
        nerikcarto.nyc_subway_stations_l_isos
        WHERE
        data_range = <%= data.range %>
        AND
        station_id = <%= data.station_id %>
        LIMIT 1
        )
      )
    <% } %>
  </script>

  <script type="text/template" id="css_per_capita_income">
    @p1:#ffe1d3;
    @p2:#ffcaa1;
    @p3:#ffb283;
    @p4:#ff9674;
    @p5:#f97b72;
    @p6:#ee6076;
    @p7:#df467b;
    @p8:#cc2d7f;
    @p9:#b31680;
    @p10:#97097c;

    #nyc_census_clipped {
      polygon-fill: #D3D3D3;
      polygon-opacity: 1;
      line-width: 1.5;
      line-color: #fff;
      line-opacity: 0.9;

      [ per_capita_income <= 369260] {
      polygon-fill:  @p10;
      line-color: darken(@p10,5);
      }
      [ per_capita_income <= 332796] {
      polygon-fill:  @p9;
      line-color: darken(@p9,5);
      }
      [ per_capita_income <= 296333] {
       polygon-fill: @p8;
       line-color: darken(@p8,5);
      }
      [ per_capita_income <= 259869] {
       polygon-fill: @p7;
       line-color: darken(@p7,5);
      }
      [ per_capita_income <= 223406] {
       polygon-fill: @p6;
       line-color: darken(@p6,5);
      }
      [ per_capita_income <= 186942] {
       polygon-fill: @p5;
       line-color: darken(@p5,5);
      }
      [ per_capita_income <= 150479] {
       polygon-fill: @p4;
       line-color: darken(@p4,5);
      }
      [ per_capita_income <= 114015] {
       polygon-fill: @p3;
       line-color: darken(@p3,5);
      }
      [ per_capita_income <= 77552] {
       polygon-fill: @p2;
       line-color: darken(@p2,5);
      }
      [ per_capita_income <= 41088] {
       polygon-fill: @p1;
       line-color: darken(@p1,1);
     }
   }
  </script>

  <script type="text/template" id="css_median_age">
    #nyc_census_clipped{
      polygon-fill: #D3D3D3;
      polygon-opacity: 0.8;
      line-width: 1.5;
      line-color: transparent;
      line-opacity: 0.9;

      [ median_age <= 60.1] {
      polygon-fill: #e81681;
      line-color: darken(#e81681,2);
      }
      [ median_age <= 56.0] {
      polygon-fill: #f03d8c;
      line-color: darken(#f03d8c,2);
      }
      [ median_age <= 52.0] {
      polygon-fill: #f75a8c;
      line-color: darken(#f75a8c,2);
      }
      [ median_age <= 47.9] {
      polygon-fill: #fd7386;
      line-color: darken(#fd7386,5);
      }
      [ median_age <= 43.9] {
      polygon-fill: #ff8d7d;
      line-color: darken(#ff8d7d,5);
      }
      [ median_age <= 39.9] {
      polygon-fill: #ffa378;
      line-color: darken(#ffa378,5);
      }
      [ median_age <= 35.8] {
      polygon-fill: #ffb87c;
      line-color: darken(#ffb87c,5);
      }
      [ median_age <= 31.8] {
      polygon-fill: #ffcd8b;
      line-color: darken(#ffcd8b,5);
      }
      [ median_age <= 27.7] {
      polygon-fill: #ffdfa2;
      line-color: darken(#ffdfa2,5);
      }
      [ median_age <= 23.7] {
      polygon-fill: #fff0c3;
      line-color: darken(#fff0c3,5);
      }
    }
  </script>

  <script type="text/template" id="css_ethnic_1st">
    #nyc_census_clipped {
      polygon-fill: #D3D3D3;
      polygon-opacity: 0.8;
      line-width: 1.5;
      line-color: #fff;
      line-opacity: 0.9;
      [zoom<=14]{line-width:1;}

      [ethnic_1st="asian"] {
        polygon-fill: #e78ac3;
        line-color: darken(#e78ac3,5);
      }
      [ethnic_1st="black"] {
        polygon-fill: #fc8d62;
        line-color: darken(#fc8d62,5);
      }
      [ethnic_1st="hispanic or latino"] {
        polygon-fill: #F1D38D;
        line-color: darken(#F1D38D,5);
      }
      [ethnic_1st="other"] {
        polygon-fill: #D3D3D3;
        line-color: darken(#D3D3D3,5);
      }
      [ethnic_1st="white"] {
        polygon-fill: #66c2a5;
        line-color: darken(#66c2a5,5);
      }
    }
  </script>

  <script type="text/template" id="css_iso">
    @20m:#5D6588;
    @15m:#3391A8;
    @10m:#17BCA7;
    @5m:#78E089;
    @2m:#E4F966;

    #nyc_isos_copy {
      ::dropshadow{
        line-offset: -1;
        line-width: 1;
        image-filters: agg-stack-blur(2,2);
        line-color: #78909C;
        [zoom<=13]{line-width:0.5;}
      }
      polygon-opacity: 0;
      line-color: transparent;
      line-width: 2.5;
      line-opacity: 1;
      polygon-fill: transparent;

      [zoom>=15]{line-width: 3;}
      [zoom<=13]{line-width: 1.5;}

      [data_range<=1200] {
      line-color: @20m;
      polygon-fill: @20m;
      }
      [data_range<=900] {
      line-color: @15m;
      polygon-fill: @15m;
      }
      [data_range<=600] {
      line-color: @10m;
      polygon-fill: @10m;
      }
      [data_range<=300] {
      line-color: @5m;
      polygon-fill:@5m;
      }
      [data_range<=120] {
      line-color: @2m;
      polygon-fill:@2m;
      }
    }
  </script>

  <script type="text/template" id="html_legend">
    <div class="CDB-Legend">
      <% if (index === 0) { %>
        <h2 class="CDB-Legend-title">Income</h2>
        <ul class="CDB-Legend-list">
          <li class="CDB-Legend-listItem">
            <div class="CDB-ColorRamp">
              <ul class="CDB-ColorRamp-text">
                <li>Lower</li>
                <li>Higher</li>
              </ul>
              <div class="CDB-ColorRamp-info" style="background-image: linear-gradient(90deg, #ffe1d3, #ffcaa1, #ffb283, #ff9674, #f97b72, #ee6076, #df467b, #cc2d7f, #b31680, #97097c);">
              </div>
            </div>
          </li>
        </ul>
      <% } %>

      <% if (index === 1) { %>
        <h2 class="CDB-Legend-title">Age</h2>
        <ul class="CDB-Legend-list">
          <li class="CDB-Legend-listItem">
            <div class="CDB-ColorRamp">
              <ul class="CDB-ColorRamp-text">
                <li>Younger</li>
                <li>Older</li>
              </ul>
              <div class="CDB-ColorRamp-info" style="background-image: linear-gradient(90deg, #fff0c3, #ffdfa2, #ffcd8b, #ffb87c, #ffa378, #ff8d7d, #fd7386, #f75a8c, #f03d8c, #e81681);">
              </div>
            </div>
          </li>
        </ul>
      <% } %>

    <% if (index === 2) { %>
      <h2 class="CDB-Legend-title">Ethnic group</h2>
      <ul class="CDB-Legend-list CDB-Legend-list--multiple">
        <li class="CDB-Legend-listItem CDB-Legend-listItem--multiple">
          <span class="CDB-Legend-point" style="background: #e78ac3;"></span>
          <span class="CDB-Legend-listItemText">asian</span>
        </li>
        <li class="CDB-Legend-listItem CDB-Legend-listItem--multiple">
          <span class="CDB-Legend-point" style="background: #fc8d62;"></span>
          <span class="CDB-Legend-listItemText">black</span>
        </li>
        <li class="CDB-Legend-listItem CDB-Legend-listItem--multiple">
          <span class="CDB-Legend-point" style="background: #F1D38D;"></span>
          <span class="CDB-Legend-listItemText">hispanic or latino</span>
        </li>
        <li class="CDB-Legend-listItem CDB-Legend-listItem--multiple">
          <span class="CDB-Legend-point" style="background: #66c2a5;"></span>
          <span class="CDB-Legend-listItemText">white</span>
        </li>
        <li class="CDB-Legend-listItem CDB-Legend-listItem--multiple">
          <span class="CDB-Legend-point" style="background: #D3D3D3;"></span>
          <span class="CDB-Legend-listItemText">other</span>
        </li>
      </ul>
    <% } %>
  </script>

  <script src="vis.js"></script>
  <script src="index.js"></script>
</body>
</html>
